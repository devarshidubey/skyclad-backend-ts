{"level":"error","message":"Cast to ObjectId failed for value \"{ id: '03359074-e4d9-400f-b193-7de2f7ea1d79' }\" (type Object) at path \"_id\" for model \"User\"","service":"user-service","stack":"CastError: Cast to ObjectId failed for value \"{ id: '03359074-e4d9-400f-b193-7de2f7ea1d79' }\" (type Object) at path \"_id\" for model \"User\"\n    at SchemaObjectId.cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaType.applySetters (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schemaType.js:1259:12)\n    at SchemaType.castForQuery (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schemaType.js:1695:17)\n    at cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\cast.js:319:34)\n    at Query.cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at Query._castConditions (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:3477:8)\n    at model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async updateUserRole (file:///D:/work/skyclad_backend/dist/services/user/user.service.js:3:25)"}
{"level":"error","message":"[\n  {\n    \"origin\": \"string\",\n    \"code\": \"invalid_format\",\n    \"format\": \"regex\",\n    \"pattern\": \"/^[a-zA-Z0-9 _.-]{1,100}$/\",\n    \"path\": [\n      \"filename\"\n    ],\n    \"message\": \"Invalid filename\"\n  }\n]","service":"user-service","stack":"ZodError: [\n  {\n    \"origin\": \"string\",\n    \"code\": \"invalid_format\",\n    \"format\": \"regex\",\n    \"pattern\": \"/^[a-zA-Z0-9 _.-]{1,100}$/\",\n    \"path\": [\n      \"filename\"\n    ],\n    \"message\": \"Invalid filename\"\n  }\n]\n    at createDocument (file:///D:/work/skyclad_backend/dist/controllers/document/document.controller.js:7:45)\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:157:13)\n    at authorize (file:///D:/work/skyclad_backend/dist/middlewares/auth.middleware.js:18:9)\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:157:13)\n    at Route.dispatch (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:117:3)\n    at handle (D:\\work\\skyclad_backend\\node_modules\\router\\index.js:435:11)\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at D:\\work\\skyclad_backend\\node_modules\\router\\index.js:295:15"}
{"level":"error","message":"Cannot call `create()` with a session and multiple documents unless `ordered: true` is set","service":"user-service","stack":"MongooseError: Cannot call `create()` with a session and multiple documents unless `ordered: true` is set\n    at Function.create (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\model.js:2711:11)\n    at file:///D:/work/skyclad_backend/dist/services/document/document.service.js:43:27\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async runInTransaction (file:///D:/work/skyclad_backend/dist/utils/transaction.js:6:24)\n    at async createDocument (file:///D:/work/skyclad_backend/dist/controllers/document/document.controller.js:9:24)"}
{"level":"error","message":"Cannot call `create()` with a session and multiple documents unless `ordered: true` is set","service":"user-service","stack":"MongooseError: Cannot call `create()` with a session and multiple documents unless `ordered: true` is set\n    at Function.create (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\model.js:2711:11)\n    at file:///D:/work/skyclad_backend/dist/services/document/document.service.js:43:27\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async runInTransaction (file:///D:/work/skyclad_backend/dist/utils/transaction.js:6:24)\n    at async createDocument (file:///D:/work/skyclad_backend/dist/controllers/document/document.controller.js:9:24)"}
{"level":"error","message":"E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"15 aug 2025\" }","service":"user-service","stack":"MongoServerError: E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"15 aug 2025\" }\n    at InsertOneOperation.handleOk (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\insert.js:51:19)\n    at tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:214:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.insertOne (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:154:16)"}
{"level":"error","message":"Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }","service":"user-service","stack":"MongoServerError: Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }\n    at Connection.sendCommand (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:306:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async Connection.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:334:26)\n    at async Server.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\sdam\\server.js:194:29)\n    at async tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:213:32)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:544:16)\n    at async model.Query._findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:3536:13)\n    at async model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at async file:///D:/work/skyclad_backend/dist/services/document/document.service.js:8:31"}
{"level":"error","message":"Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }","service":"user-service","stack":"MongoServerError: Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }\n    at Connection.sendCommand (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:306:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async Connection.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:334:26)\n    at async Server.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\sdam\\server.js:194:29)\n    at async tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:213:32)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:544:16)\n    at async model.Query._findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:3536:13)\n    at async model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at async file:///D:/work/skyclad_backend/dist/services/document/document.service.js:8:31"}
{"level":"error","message":"Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }","service":"user-service","stack":"MongoServerError: Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }\n    at Connection.sendCommand (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:306:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async Connection.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:334:26)\n    at async Server.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\sdam\\server.js:194:29)\n    at async tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:213:32)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:544:16)\n    at async model.Query._findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:3536:13)\n    at async model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at async file:///D:/work/skyclad_backend/dist/services/document/document.service.js:8:31"}
{"level":"error","message":"Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }","service":"user-service","stack":"MongoServerError: Plan executor error during findAndModify :: caused by :: E11000 duplicate key error collection: skyclad-db.tags index: name_1 dup key: { name: \"invoice_2025\" }\n    at Connection.sendCommand (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:306:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async Connection.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\cmap\\connection.js:334:26)\n    at async Server.command (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\sdam\\server.js:194:29)\n    at async tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:213:32)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:544:16)\n    at async model.Query._findOneAndUpdate (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:3536:13)\n    at async model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at async file:///D:/work/skyclad_backend/dist/services/document/document.service.js:8:31"}
{"level":"error","message":"E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"14 aug 2025\" }","service":"user-service","stack":"MongoServerError: E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"14 aug 2025\" }\n    at InsertOneOperation.handleOk (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\insert.js:51:19)\n    at tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:214:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.insertOne (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:154:16)"}
{"level":"error","message":"E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"14 aug 2025\" }","service":"user-service","stack":"MongoServerError: E11000 duplicate key error collection: skyclad-db.documents index: filename_1 dup key: { filename: \"14 aug 2025\" }\n    at InsertOneOperation.handleOk (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\insert.js:51:19)\n    at tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:214:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.insertOne (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:154:16)"}
{"level":"error","message":"E11000 duplicate key error collection: skyclad-db.documents index: ownerId_1_primaryTagId_1_filename_1 dup key: { ownerId: ObjectId('68ef4d7a01d3cebe88c1e379'), primaryTagId: ObjectId('68f0f92f2b3acbcb664671a3'), filename: \"02 Jan 2025\" }","service":"user-service","stack":"MongoServerError: E11000 duplicate key error collection: skyclad-db.documents index: ownerId_1_primaryTagId_1_filename_1 dup key: { ownerId: ObjectId('68ef4d7a01d3cebe88c1e379'), primaryTagId: ObjectId('68f0f92f2b3acbcb664671a3'), filename: \"02 Jan 2025\" }\n    at InsertOneOperation.handleOk (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\insert.js:51:19)\n    at tryOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:214:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\operations\\execute_operation.js:78:16)\n    at async Collection.insertOne (D:\\work\\skyclad_backend\\node_modules\\mongodb\\lib\\collection.js:154:16)"}
{"level":"error","message":"Cast to ObjectId failed for value \"invoice_2020\" (type string) at path \"primaryTagId\" for model \"Document\"","service":"user-service","stack":"CastError: Cast to ObjectId failed for value \"invoice_2020\" (type string) at path \"primaryTagId\" for model \"Document\"\n    at SchemaObjectId.cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaType.applySetters (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schemaType.js:1259:12)\n    at SchemaType.castForQuery (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\schemaType.js:1695:17)\n    at cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at Query.cast (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at Query._castConditions (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (D:\\work\\skyclad_backend\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async processFolderAction (file:///D:/work/skyclad_backend/dist/services/action/action.service.js:10:23)"}
{"level":"error","message":"input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"user-service","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (D:\\work\\skyclad_backend\\node_modules\\bson\\lib\\bson.cjs:2538:23)\n    at getDocument (file:///D:/work/skyclad_backend/dist/controllers/document/document.controller.js:7:28)\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:157:13)\n    at file:///D:/work/skyclad_backend/dist/middlewares/permissions.middleware.js:12:9\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:157:13)\n    at authorize (file:///D:/work/skyclad_backend/dist/middlewares/auth.middleware.js:18:9)\n    at Layer.handleRequest (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (D:\\work\\skyclad_backend\\node_modules\\router\\lib\\route.js:157:13)"}
{"level":"error","message":"DB disconnected","service":"user-service"}
